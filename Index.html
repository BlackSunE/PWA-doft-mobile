<!DOCTYPE html>
<html lang="es_ES">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>First PWA model DOFT</title>
  <!--Manifiesto-->
  <link rel="manifest" href="./Manifest/manifest.json">
  <meta name="theme-color" content="#1a1a1a">
  <!-- Detección de Icono de PWA -->
    <link rel="icon" type="image/png" sizes="16x16" href="./img/icon_16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./img/icon_32x32.png">
    <link rel="icon" type="image/png" sizes="64x64" href="./img/icon_64x64.png">
    <link rel="icon" type="image/png" sizes="96x96" href="./img/icon_96x96.png">
    <link rel="icon" type="image/png" sizes="128x128" href="./img/icon_128x128.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./img/icon_192x192.png">
    <link rel="icon" type="image/png" sizes="256x256" href="./img/icon_256x256.png">
    <link rel="icon" type="image/png" sizes="384x384" href="./img/icon_384x384.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./img/icon_512x512.png">
    <link rel="icon" type="image/png" sizes="1024x1024" href="./img/icon_1024x1024.png">
  <!--meta etiquetas PWA en ios-->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="PWA-Doft">
   <!-- Metatags Windows -->
    <meta name="msapplication-TileColor" content="#F7DF1E">
    <meta name="msapplication-TileImage" content="./img/icon_192x192.png">
  <!--Styles-->
  <link rel="stylesheet" href="./Styles/style.css">
  <!--Google fonts-->
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP" rel="stylesheet">
  <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/all.js" integrity="sha384-xymdQtn1n3lH2wcu0qhcdaOpQwyoarkgLVxC/wZ5q7h9gHtxICrpcaSUfygqZGOe" crossorigin="anonymous"></script>
  <!--removiendo-touch-styles-internet explorer-->
  <meta name="msapplication-tap-highlight" content="no">
</head>
<body>
  <header>
    <div id="barras"><i class="fas fa-bars" onclick="opennav()"></i></div>
    <div id="Logo">
      <a href="index.html">
        <img src="./Logos/Official_logo_mejorado.svg" alt="Doft">
      </a>
    </div>
    <div id="lupa"><i class="fas fa-search" onclick="hide()"></i></div>
    <!-- Menu Dipositivo mobil-->
    <div id="menu_desplegable">
      <div id="close"><i class="far fa-times-circle"></i></div>
      <div id="acceso_rápido" class="clearfix">
        <span id="loginO"><i class="fas fa-user"></i></span>
        <span id="notificacionesO"><i class="fas fa-bell"></i></span>
      </div>
      <ul id="principal_mobile_list">
        <li><a href="#"><i class="fas fa-caret-right"></i>estilo</a>
          <ul>
            <li><a href="#">Nueva Colección</a></li>
            <li><a href="#">Accesorios</a></li>
            <li><a href="#">Camisetas &amp; Camisas</a></li>
            <li><a href="#">Chaquetas</a></li>
            <li><a href="#">Pantalones</a></li>
            <li><a href="#">Sudaderas</a></li>
          </ul>
        </li>
        <li><a href="#"><i class="fas fa-caret-right"></i>personaliza</a>
          <ul>
            <li><a href="#">Nueva Colección</a></li>
            <li><a href="#">Accesorios</a></li>
            <li><a href="#">Camisetas &amp; Camisas</a></li>
            <li><a href="#">Chaquetas</a></li>
            <li><a href="#">Pantalones</a></li>
            <li><a href="#">Sudaderas</a></li>
          </ul>
        </li>
        <li><a href="#"><i class="fas fa-caret-right"></i>novedades</a>
          <ul>
            <li><a href="#">Nueva Colección</a></li>
            <li><a href="#">Accesorios</a></li>
            <li><a href="#">Camisetas &amp; Camisas</a></li>
            <li><a href="#">Chaquetas</a></li>
            <li><a href="#">Pantalones</a></li>
            <li><a href="#">Sudaderas</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </header>
  <div id="buscador" style="padding: 4px 1% 6px 1%; max-height: 90px">
    <form action="">
      <input type="text" name="Buscar" required="" autocomplete="off" placeholder="Buscar..."><button class="cancel-search" type="reset" value="reset"><i class="fas fa-times"></i></button>
    </form>
  </div>
  <section>
    <img src="./Images/Condimento para tacos hecho en casa 2.jpg" alt="tacos" style="width:100%;">
  </section>
  <footer>
  	<ul>
  		<li name="content"><a>Social-media</a></li>
  		<li><a>Novedades</a></li>
  		<li><a>Acerca de</a></li>
  		<li name="content"><a>Ayuda</a></li>
  		<li name="content"><a>Contacto</a></li>
  	</ul>
  	<ul>
  		<li><a><i class="fab fa-rocketchat"></i></a></li>
  		<li><a><i class="fas fa-envelope"></i></a></li>
  	</ul>
  	<ul>
  		<li><a>©Doft 2019. Todos los derechos reservados. Powered by</a></li>
  		<li><img src="./Logos/Colaboracion_EJ2_blanco.svg" alt="EJ"></li>
  	</ul>
  </footer>
  <script type="text/javascript">

//botones para abrir y cerrar el menu de navegacion.
    function opennav() {
      $('#menu_desplegable').style.left = "0";
    }

    if()

    const closenav = $('#close');
    const menuMobil = $('#menu_desplegable')
    function cerrarNav() {
      menuMobil.style.left = "-70%";
    }
    closenav.addEventListener("touchstart", cerrarNav);
    menuMobil.addEventListener("touchmove", function (e) {
      var obtenerPosicion = function () {
        var point = {};
        if(e.targetTouches){
          point.x = e.targetTouches[0].clientX;
          point.y = e.targetTouches[0].clientY;
        }
        return point;
      }
      if (e.touches) {
        var Xini = e.targetTouches[0];
        this.style.transform = ""
      }
    });
//funcion para abrir y cerrar buscador
    function hide() {
      var buscador = $('#buscador');
      function delayHeight(maxheight, padding, duracion) {
        buscador.style.maxHeight = maxheight;
        setTimeout(function() {buscador.style.padding = padding}, duracion);
      }
        if (buscador.style.padding === "0px 1%") {
          delayHeight("90px", "4px 1% 6px 1%", 0);
        } else {
          delayHeight("0px", "0px 1%", 0);
        }
    }

//Array.potoype.forEach.call() llama al Array en si lo que entiendo es que los HTMLCollections son Arrays dados a Array.prototype por eso hay que declarar explitamente a Array.p https://stackoverflow.com/questions/43743560/foreach-vs-array-prototype-foreach-call
//funcion de listas de navegacion para telefonos moviles.
        const aButton = $A('#principal_mobile_list > li > a');
        const listasDesplegable = $A('#principal_mobile_list li > ul');
        const rotarFlechas = document.getElementsByClassName('fa-caret-right');
        function porDefecto() {
            Array.prototype.forEach.call(listasDesplegable, el => {el.style.maxHeight = "0px"});
            Array.prototype.forEach.call(rotarFlechas, el => {el.style.transform = "rotate(0deg)"});
          }
        porDefecto();
        var longitud = aButton.length;
        for(let i = 0;i < longitud; i++){
           aButton[i].addEventListener("touchstart", function() {
            var desplegar = function (height, rotate) {
               listasDesplegable[i].style.maxHeight = height;
               rotarFlechas[i].style.transform = rotate;
             }
                if (listasDesplegable[i].style.maxHeight <= "10px") {
                  porDefecto();
                  desplegar("200px", "rotate(90deg)");
                } else {
                  desplegar("0px", "rotate(0deg)");
                }
          });
        }

//callback para cerrar menu de navegacion
const listasBotonesA = $A('#principal_mobile_list li ul li a');
var longituh = listasBotonesA.length;
for (let i = 0; i < longituh; i++) {
  listasBotonesA[i].addEventListener('touchstart', cerrarNav);
}

//añadiendo soporte para todos los navegadores en eventos de inicio, movimiento y final para la mayoria de buscadores y dispositivos.
//Encontrar puntero y guardar puntero
function getGesturePointFromEvent(evt) {
    var point = {};

    if(evt.targetTouches) {
      // Prefer Touch Events
      point.x = evt.targetTouches[0].clientX;
      point.y = evt.targetTouches[0].clientY;
    } else {
      // Either Mouse event or Pointer Event
      point.x = evt.clientX;
      point.y = evt.clientY;
    }

    return point;
  }
//optimizacion de frames para touchmove y pointermove.
  function onAnimFrame() {
  if(!rafPending) {
    return;
  }

  var differenceInX = initialTouchPos.x - lastTouchPos.x;

  var newXTransform = (currentXPosition - differenceInX)+'px';
  var transformStyle = 'translateX('+newXTransform+')';
  element.style.webkitTransform = transformStyle;
  element.style.MozTransform = transformStyle;
  element.style.msTransform = transformStyle;
  element.style.transform = transformStyle;

  rafPending = false;
}
// Encargado de los gestos de inicio
this.handleGestureStart = function(evt) {
  evt.preventDefault();

  if(evt.touches && evt.touches.length > 1) {
    return;
  }

  // Add the move and end listeners
  if (window.PointerEvent) {
    evt.target.setPointerCapture(evt.pointerId);
  } else {
    // Add Mouse Listeners
    document.addEventListener('mousemove', this.handleGestureMove, true);
    document.addEventListener('mouseup', this.handleGestureEnd, true);
  }

  initialTouchPos = getGesturePointFromEvent(evt);

  swipeFrontElement.style.transition = 'initial';
}.bind(this);

// Encargdo de los gestos de fin
this.handleGestureEnd = function(evt) {
  evt.preventDefault();

  if(evt.touches && evt.touches.length > 0) {
    return;
  }

  rafPending = false;

  // Remove Event Listeners
  if (window.PointerEvent) {
    evt.target.releasePointerCapture(evt.pointerId);
  } else {
    // Remove Mouse Listeners
    document.removeEventListener('mousemove', this.handleGestureMove, true);
    document.removeEventListener('mouseup', this.handleGestureEnd, true);
  }

  updateSwipeRestPosition();

  initialTouchPos = null;
}.bind(this);

//encargado de los eventos de movimiento.
this.handleGestureMove = function (evt) {
  evt.preventDefault();

  if(!initialTouchPos) {
    return;
  }

  lastTouchPos = getGesturePointFromEvent(evt);

  if(rafPending) {
    return;
  }

  rafPending = true;

  window.requestAnimFrame(onAnimFrame);
}.bind(this);

function supportEvents(element) {
// Check if pointer events are supported.
  if (window.PointerEvent) {
    // Add Pointer Event Listener
    element.addEventListener('pointerdown', this.handleGestureStart, true);
    element.addEventListener('pointermove', this.handleGestureMove, true);
    element.addEventListener('pointerup', this.handleGestureEnd, true);
    element.addEventListener('pointercancel', this.handleGestureEnd, true);
  } else {
    // Add Touch Listener
    element.addEventListener('touchstart', this.handleGestureStart, true);
    element.addEventListener('touchmove', this.handleGestureMove, true);
    element.addEventListener('touchend', this.handleGestureEnd, true);
    element.addEventListener('touchcancel', this.handleGestureEnd, true);

    // Add Mouse Listener
    element.addEventListener('mousedown', this.handleGestureStart, true);
  }
}

    function $(selector) {
      return document.querySelector(selector);
    }

    function $A(selectorAll) {
      return document.querySelectorAll(selectorAll);
    }

  </script>
</body>
</html>
